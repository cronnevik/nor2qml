<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Map view</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <style scoped>
        body {
            margin: 10px 20px;
        }

        #mapid {
            width: 80vw;
            height: 750px;
        }

        .event-table {
            width: 50vw;
        }
    </style>
</head>
<body>
    <h1>Preview of Data</h1>
    <dl class="row">
        <dt class="col-md-1">Request url: </dt><dd class="col-md-11" th:text="${requrl} + ${query}"></dd>
    </dl>

    <div class="d-flex align-items-start">
        <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <button
                class="nav-link active" id="v-pills-map-tab"
                data-bs-toggle="pill" data-bs-target="#v-pills-map"
                type="button" role="tab"
                aria-controls="v-pills-map" aria-selected="true"
            >
                Map View
            </button>
            <button
                    class="nav-link" id="v-pills-profile-tab"
                    data-bs-toggle="pill" data-bs-target="#v-pills-profile"
                    type="button" role="tab"
                    aria-controls="v-pills-profile" aria-selected="false"
            >
                Table view
            </button>
        </div>
        <div class="tab-content" id="v-pills-tabContent">
            <div
                class="tab-pane fade show active" id="v-pills-map"
                role="tabpanel" aria-labelledby="v-pills-map-tab"
            >
                <div id="mapid"></div>
            </div>
            <div
                class="tab-pane fade" id="v-pills-profile"
                role="tabpanel" aria-labelledby="v-pills-profile-tab"
            >
                <table class="event-table">
                    <thead>
                    <tr>
                        <th>Time</th>
                        <th>Latitude</th>
                        <th>Longitude</th>
                        <th>Depth</th>
                        <th>Magnitude</th>
                        <th>Event Type</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="ev : ${events}">
                        <td><span th:text="${ev.time}"></span></td>
                        <td><span th:text="${ev.latitude}"></span></td>
                        <td><span th:text="${ev.longitude}"></span></td>
                        <td><span th:text="${ev.depth}"></span></td>
                        <td><span th:text="${ev.magnitude}"></span></td>
                        <td><span th:text="${ev.eventType}"></span></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        const map = L.map('mapid').setView([60.3913, 5.3221], 5);
        const mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        const wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; '+mapLink+', '+wholink,
                maxZoom: 18,
            }).addTo(map);

        const eventData = [[${events}]]
        const markers = [];
        for (let i = 0; i < eventData.length; i++) {
            const event = eventData[i];
            const marker = L.marker(L.latLng(event.latitude, event.longitude)).addTo(map);
            marker.bindPopup(
                '<dl class="row">' +
                '<dt class="col-sm-3">time: </dt><dd class="col-sm-9">' + event.time +  '</dd>' +
                '<dt class="col-sm-3">latitude: </dt><dd class="col-sm-9">' + event.latitude +  '</dd>' +
                '<dt class="col-sm-3">longitude: </dt><dd class="col-sm-9">' + event.longitude +  '</dd>' +
                '<dt class="col-sm-3">depth: </dt><dd class="col-sm-9">' + event.depth +  '</dd>' +
                '<dt class="col-sm-3">magnitude: </dt><dd class="col-sm-9">' + event.magnitude +  '</dd>' +
                '<dt class="col-sm-3">type: </dt><dd class="col-sm-9">' + event.eventType +  '</dd>' +
                '</dl>'
            , {minWidth: 250});
            markers.push(marker);
        }

    </script>
</body>
</html>