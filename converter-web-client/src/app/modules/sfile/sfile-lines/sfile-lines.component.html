<div class="row col-md-12">
  <h3>Configuration of QuakeML</h3>
</div>
<div *ngIf="error != null">
  <p>Cannot generate QuakeML due to:</p>
  <div *ngFor="let err of error.errors">
    <p class="error-sfile-message" >{{ err.message }} in S-file num: {{ err.eventNumber }}, line type: {{ err.line.lineNumber }}</p>
  </div>
</div>
<div class="row">
  <div class="col-md-9">
    <div>
      Output Version:
      <div *ngFor="let opt of qmlVersions">
          <div class="custom-control custom-radio">
              <input class="custom-control-input" type="radio" id="{{ opt.value }}" [(ngModel)]="options.version" name="qml_name" value="{{ opt.value }}" (change)="onVerOptionChange(opt)" />
              <label class="custom-control-label" for="{{ opt.value }}">{{ opt.name }}</label>
            </div>
      </div>
    </div>

    <div class="margin-top-20">
      Public IDs:
      <ul>
        <li>The public IDs will take the form of: [smi|quakeml]:[authority-id]/[resource-id]#[local-id]</li>
        <li>Prefix and autority-id are determined by the user. Please specify below.</li>
        <li>Resource-id (Entity) and local-id (12 char random) will automatically be generated by the converter.</li>
      </ul>
    </div>

    <div class="margin-top-20">
      <span>Prefix (quakeml | smi)</span>
      <select class="custom-select" [(ngModel)]="options.id.prefix">
          <option [ngValue]="pre.value" *ngFor="let pre of qmlPrefix">{{ pre.value }}</option>
      </select>
      <span>Authority ID in the form of (top-level domain).(organisation/institution)[.(sub-unit of organisation)]</span>
      <input class="form-control" placeholder="Please specify your Authority ID (e.g. no.uib.nnsn) - Default value is 'authorityid'" [(ngModel)]="options.id.agencyID" />
    </div>
  </div>
  <div class="col-md-3">
    <button class="btn btn-success btn-block" (click)="configXml()">Generate XML</button>
  </div>
</div>

<div class="row col-md-12 margin-top-20">
  <h3>Error Handling</h3>
  <div *ngFor="let opt of errorHandling" class="col-md-12">
      <div class="custom-control custom-radio">
          <input class="custom-control-input" type="radio" id="{{ opt.value }}" [(ngModel)]="options.errorHandling" name="err_name" value="{{ opt.value }}" (change)="onErrOptionChange(opt)" />
          <label class="custom-control-label" for="{{ opt.value }}">{{ opt.name }}</label>
        </div>
  </div>
</div>

<div class="row col-md-12 margin-top-20">
  <h3>List of S-files which will be converted <span *ngIf="events">({{events.length}} events)</span></h3>
  <ul>
    <li>
        Click on each line type cell (number) for more details on each line and the option to edit each field.
    </li>
    <li>
        Click on the <i class="fa fa-info-circle"></i> icon to see the whole raw s-file (changes made in fields are not reflected here).
    </li>
    <li>
        Click on the <i class="fa fa-trash"></i> icon to remove the event/s-file from conversion.
    </li>
  </ul>

  <table class="table table-striped table-responsive">
    <thead>
      <th scope="col" class="num-bold">#</th>
      <th scope="col">Type 1</th>
      <th scope="col">Type 2</th>
      <th scope="col">Type 3</th>
      <th scope="col">Type 4</th>
      <th scope="col">Type 5</th>
      <th scope="col">Type 6</th>
      <th scope="col">Type E</th>
      <th scope="col">Type F</th>
      <th scope="col">Type I</th>
      <th scope="col">Type M1</th>
      <th scope="col">Type M2</th>
      <th scope="col">Actions</th>
    </thead>
    <tbody>
      <tr *ngFor="let ev of events; let i = index">
        <td class="num-bold">{{ i + 1 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line1')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line1 ? ev.line1.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line2')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line2 ? ev.line2.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line3')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line3 ? ev.line3.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line4')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line4 ? ev.line4.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line5')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line5 ? ev.line5.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'line6')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.line6 ? ev.line6.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'lineE')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.lineE ? ev.lineE.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'lineF')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.lineF ? ev.lineF.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'lineI')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.lineI ? ev.lineI.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'lineM1s')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.lineM1s ? ev.lineM1s.length : 0 }}</td>
        <td class="cursor-pointer type-num-link" (click)="userSelectLine(ev, 'lineM2s')" data-toggle="modal" data-target="#sfileModalLine">{{ ev.lineM2s ? ev.lineM2s.length : 0 }}</td>
        <td>
          <i class="fa fa-info-circle cursor-pointer" data-toggle="modal" data-target="#sfileModalRaw" (click)="userSelectRaw(ev)"></i>
          <i class="fa fa-trash cursor-pointer margin-left-10" (click)="deleteEventFromList(ev)"></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal raw data -->
<div class="modal fade" id="sfileModalRaw" tabindex="-1" role="dialog" aria-labelledby="sfileModalRawTitle" aria-hidden="true" *ngIf="selectedRaw != null">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sfileModalRawTitle">Sfile - Raw data</h5>
        <button type="button" class="close" (click)="clearSelected()" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ngx-prism
        [language]="language"
        [code] = "textRawOutput"
        [interpolation] = "interpolate"
        ></ngx-prism>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Line data -->
<div class="modal fade" id="sfileModalLine" tabindex="-1" role="dialog" aria-labelledby="sfileModalLineTitle" aria-hidden="true" *ngIf="selectedLine != null">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sfileModalLineTitle">Sfile - Line data view/edit</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <table class="table table-striped">
              <thead>
                <th class="num-bold">#</th>
                <ng-container *ngIf="selectedLine[0] != null">
                    <ng-container *ngFor="let key of objectKeys(selectedLine[0])">
                        <th scope="col"
                        *ngIf="key !== 'lineText' &&
                        key !== 'lineNumber' &&
                        key !== 'rowNumber' &&
                        key !== 'orgID' &&
                        key !== 'lineType' &&
                        key !== 'relatedLine1' &&
                        key !== 'descriptionType'"
                       >
                         {{ transformObjectKey(key) }}
                       </th>
                    </ng-container>
                </ng-container>
              </thead>
              <tbody>
                <tr *ngFor="let line of selectedLine; let idx = index">
                  <td class="num-bold">{{ idx + 1 }}</td>
                  <ng-container *ngIf="line != null">
                      <ng-container *ngFor="let val of objectValues(line)">
                          <td *ngIf="val !== null && isObjectNotRelation(val)">
                            <input class="form-control td-text" [(ngModel)]="val.value" />
                          </td>
                      </ng-container>
                  </ng-container>
                </tr>
              </tbody>
            </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" (click)="saveEditedLines()" data-dismiss="modal">Save</button>
          <button type="button" class="btn btn-secondary" (click)="clearSelected()" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
